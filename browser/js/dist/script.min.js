var app=angular.module("lookUp",["ui.router"]);app.config(function(n,e){n.otherwise("/")}),app.directive("luMapBuildings",function(n,e,i){return{restrict:"E",scope:{buildings:"=",map:"="},link:function(n,e,i){}}}),app.controller("BuildingsCtrl",function(n,e,i,t){var l=document.getElementById("buildings-map");n.map=i.initializeMap(l),n.searchLoc=e.loc,n.styles=[],n.architects=[],n.activeFilters={},i.findLocation(e.loc,n.map).then(function(e){return n.map.setCenter({lat:e[1],lng:e[0]}),n.map.setZoom(12),t.findByLocation(e.join(","))}).then(function(e){n.buildings=e,e.forEach(function(e){i.drawMarker(e,n.map),n.styles.push(e.style),n.architects.push(e.architect)})}),n.activateFilter=function(e){n.activeFilters[e._id]=e.name},n.deactivateFilter=function(e){Object.keys(n.activeFilters).forEach(function(i){n.activeFilters[i]===e&&delete n.activeFilters[i]})}}),app.factory("Buildings",function(n){}),app.config(function(n){n.state("allBuildings",{url:"/buildings",templateUrl:"/templates/buildings.html",controller:"BuildingsCtrl"}),n.state("buildingsByLoc",{url:"/buildings/location/:loc",templateUrl:"/buildings/buildings.html",controller:"BuildingsCtrl"})}),app.filter("architectAndStyle",function(){return function(n,e){if(n){if(0===Object.keys(e).length)return n;var i=[];return n.forEach(function(n){(e[n.architect._id]||e[n.style._id])&&i.push(n)}),i}}}),app.filter("unique",function(){return function(n){var e=[],i={};return n.forEach(function(n){i[n._id]||(i[n._id]=!0,e.push(n))}),e}}),app.controller("HomeCtrl",function(){}),app.config(function(n,e){n.state("home",{url:"/",templateUrl:"/home/home.template.html",controller:"HomeCtrl"})}),app.controller("NewBuildingCtrl",function(n,e,i){var t=document.getElementById("new-building-map"),l=e.initializeMap(t);n.newBuilding={},n.query={name:"Empire State Building",location:"New York"},n.findNewBuilding=function(){e.findNewBuilding(n.query.name,n.query.location,l).then(function(e){n.searchResults={name:e.name,address:e.address},n.newBuilding.location=e.location,n.newBuilding.address=e.address,n.newBuilding.name=n.query.name}).then(null,function(){n.searchResults={name:"No building found"}})},n.addNewBuilding=i.addNewBuilding}),app.config(function(n,e){e.when("/new","/new/search"),n.state("newBuilding",{url:"/new",templateUrl:"/new-building/new-building.html",controller:"NewBuildingCtrl"}),n.state("newBuilding.search",{url:"/search",templateUrl:"/new-building/new-building-search.html"}),n.state("newBuilding.verify",{url:"/verify",templateUrl:"/new-building/new-building-verify.html"}),n.state("newBuilding.info",{url:"/info",templateUrl:"/new-building/new-building-info.html"})}),app.directive("luMapSingle",function(n){return{restrict:"E",scope:{buildings:"="},link:function(e,i,t){var l=i[0],r=n.initializeMap(l),o=[];e.buildings.forEach(function(e){o.push(n.drawMarker(e,r))}),1===e.buildings.length&&(r.setCenter(o[0].position),r.setZoom(16))}}}),app.controller("SingleBuildingCtrl",function(n,e,i){n.building=i}),app.config(function(n){n.state("singleBuilding",{url:"/buildings/:id",templateUrl:"/single-building/single-building.html",controller:"SingleBuildingCtrl",resolve:{building:function(n,e){return n.findById(e.id)}}})}),app.factory("BuildingUtils",function(n,e){var i=function(i){return n.post("/api/buildings",i).then(function(n){e.go("home")})},t=function(e){return n({url:"/api/buildings",method:"GET",params:{location:e}}).then(function(n){return n.data}).then(null,console.error.bind(console))},l=function(e){return n.get("/api/buildings/"+e).then(function(n){return n.data}).then(null,console.error.bind(console))};return{addNewBuilding:i,findByLocation:t,findById:l}}),app.factory("Maps",function(n){var e=function(n,e,i){e=e||{lat:0,lng:0},i=i||0;var t=new google.maps.Map(n,{center:e,scrollwheel:!1,zoom:0});return t},i=function(n,e){e.setCenter(n)},t=function(n,e){var i=new google.maps.Marker({position:{lat:n.location[1],lng:n.location[0]},map:e,title:n.name}),t=new google.maps.InfoWindow({content:"<p>"+n.name+"</p><p>"+n.architect.name+"</p><p>"+n.style.name+'</p><a href="/#/buildings/'+n._id+'">More</a> <a href="/#/buildings/'+n._id+'/edit">Edit</a>'});return i.addListener("click",function(){t.open(e,i)}),i},l=function(e,i,t){var l,r=new google.maps.places.PlacesService(t),o={query:e+" "+i},a=n.defer();return r.textSearch(o,function(n){if(!n.length)return a.reject(n);var e=new google.maps.Marker({position:n[0].geometry.location,map:t,title:n[0].name});t.setCenter(e.position),t.setZoom(12),l={name:n[0].name,address:n[0].formatted_address,location:[n[0].geometry.location.lng(),n[0].geometry.location.lat()]},a.resolve(l)}),a.promise},r=function(e,i){var t=new google.maps.places.PlacesService(i),l=n.defer();return t.textSearch({query:e},function(n){if(!n.length)return l.reject(n);var e=[n[0].geometry.location.lng(),n[0].geometry.location.lat()];l.resolve(e)}),l.promise};return{initializeMap:e,centerMap:i,findNewBuilding:l,findLocation:r,drawMarker:t}}),app.directive("luFilter",function(n){return{restrict:"E",templateUrl:"/buildings/filter/filter.html",scope:{options:"=",filters:"=",activate:"="},link:function(e,i,t){var l=i.find("input"),r=i.find("ul");r.find("li");r.addClass("hidden"),l.on("focus",function(){r.removeClass("hidden")}),l.on("blur",function(){n(function(){r.addClass("hidden")},200)})}}}),app.directive("buildingItem",function(){return{restrict:"E",templateUrl:"buildings/item/building.item.html",constroller:"BuildingsCtrl",scope:{building:"="}}});